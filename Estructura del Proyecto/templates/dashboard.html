{% extends "base.html" %}

{% block title %}Dashboard - Sistema de Parking{% endblock %}

{% block content %}

<div class="container mt-5">
  <div class="card shadow p-4">

```
<!-- TÃ­tulo -->
<h2 class="text-center mb-4">ðŸ“Š Dashboard</h2>

<!-- Tarjetas -->
<div class="row g-4 mb-4 text-center">
  <div class="col-12 col-md-6 col-lg-3">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <h6 class="text-secondary">Placas Registradas</h6>
        <h3 class="fw-bold text-primary">{{ total_placas }}</h3>
      </div>
    </div>
  </div>
  <div class="col-12 col-md-6 col-lg-3">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <h6 class="text-secondary">Ãšltimas Placas</h6>
        <h3 class="fw-bold text-success">{{ ultimas_placas|length }}</h3>
      </div>
    </div>
  </div>
  <div class="col-12 col-md-6 col-lg-3">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <h6 class="text-secondary">Pagos Realizados</h6>
        <h3 class="fw-bold text-warning">{{ total_pagos }}</h3>
      </div>
    </div>
  </div>
  <div class="col-12 col-md-6 col-lg-3">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <h6 class="text-secondary">Notificaciones</h6>
        <h3 class="fw-bold text-danger">{{ total_notificaciones }}</h3>
      </div>
    </div>
  </div>
</div>

<!-- Ãšltimas placas -->
<h4 class="mt-4">Ãšltimas 5 Placas</h4>
<div class="table-responsive">
  <table class="table table-bordered table-striped align-middle text-center">
    <thead class="table-dark">
      <tr>
        <th>Placa</th>
        <th>Fecha y hora</th>
      </tr>
    </thead>
    <tbody>
      {% for u in ultimas_placas %}
      <tr>
        <td>{{ u.numero }}</td>
        <td>{{ u.fecha_hora }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Ãšltimos pagos -->
<h4 class="mt-5">Ãšltimos 5 Pagos</h4>
<div class="table-responsive">
  <table class="table table-bordered table-striped align-middle text-center">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Monto</th>
        <th>Fecha</th>
      </tr>
    </thead>
    <tbody>
      {% for p in ultimos_pagos %}
      <tr>
        <td>{{ p.id }}</td>
        <td>S/. {{ p.monto }}</td>
        <td>{{ p.fecha_hora }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- GrÃ¡fico -->
<h4 class="mt-5">Registros de Placas por DÃ­a</h4>
<div class="card shadow-sm p-3">
  <canvas id="grafico" height="100"></canvas>
</div>
```

  </div>
</div>
{% endblock %}

{% block scripts %}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  const ctx = document.getElementById('grafico').getContext('2d');
  const etiquetas = {{ fechas_json|safe }};
  const datos = {{ cantidades_json|safe }};
  
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: etiquetas,
      datasets: [{
        label: 'Registros de placas',
        data: datos,
        borderWidth: 1,
        backgroundColor: 'rgba(54,162,235,0.5)',
        borderColor: 'rgba(54,162,235,1)'
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: { beginAtZero: true, ticks: { precision: 0 } }
      }
    }
  });
</script>

{% endblock %}
